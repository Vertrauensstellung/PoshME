### Stops WSERCH Service ###
### CVE-2017-8589 Search ###
$servicename = "WSEARCH"
$wsearchservice = Get-Service -Name $servicename -ErrorAction SilentlyContinue
if ($wsearchservice.Length -gt 0)
{
    ### Set variables to indicate value and key to set ###
    $RegistryPath = "HKLM:System\CurrentControlSet\Services\WSearch"
    $Name         = "START"
    $Value        = "4"
    $property    = "DWORD"
    ### Create the key if it does not exist ###
    If (-NOT (Test-Path $RegistryPath)) {
        New-Item -Path $RegistryPath -Force | Out-Null
    }  
    ### Now set the value ###
    New-ItemProperty -Path $RegistryPath -Name $Name -Value $Value -PropertyType $property -Force -ErrorAction SilentlyContinue
    Stop-Service $servicename -Force -ErrorAction SilentlyContinue
}
